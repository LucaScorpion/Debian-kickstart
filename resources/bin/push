#!/bin/bash

# Check if we are in a repo, and go to the top-level directory.
repoRoot=$(git rev-parse --show-toplevel &> /dev/null)
if [ ! $? -eq 0 ]
then
	printf "The current directory is not a Git repository.\n"
	exit 1
fi
cd "$repoRoot"

# Check if it is a maven project.
if [ -f "pom.xml" ]
then
	printf "Cleaning project...\n"
	mvn clean -q
fi

# Add all files.
git add -A

# Commit, with message if an argument was given (if not this will open an editor for the message).
if [ $# -eq 0 ]
then
	git commit
else
	git commit -m "$1"
fi

# Check if the commit was successful, push.
[ $? -eq 0 ] && git push
